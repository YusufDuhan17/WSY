{% extends "base.html" %}

{% block title %}Yeni Şifre Belirle - Şifre Yöneticisi{% endblock %}

{% block head_extra %}
<style>
    .warning-box-new {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 30px;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
    <header class="content-header">
        <h1>Yeni Şifre Belirle</h1>
        <p>Hesap: <strong>{{ user.username }}</strong></p>
    </header>

    <div class="warning-box-new">
        <div style="display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-exclamation-triangle" style="font-size: 2em;"></i>
            <div>
                <h3 style="margin: 0 0 10px 0; font-size: 1.2em;">⚠️ ÖNEMLİ UYARI</h3>
                <p style="margin: 0; line-height: 1.6;">
                    Şifreniz sıfırlandığında, <strong>güvenlik nedeniyle tüm kayıtlı şifreleriniz silinecektir.</strong><br>
                    Şifrenizi sıfırladıktan sonra yeni şifreler eklemeniz gerekecek.
                </p>
            </div>
        </div>
    </div>

    <form method="POST" class="content-form" style="max-width: 600px;">
        <div class="form-group">
            <label for="new_password">
                <i class="fas fa-key"></i> Yeni Şifre
            </label>
            <input type="password" id="new_password" name="new_password" required 
                   placeholder="Yeni şifrenizi girin (min. 8 karakter)" autocomplete="new-password"
                   oninput="updatePasswordStrength()">
            <div id="password-strength-indicator" style="margin-top: 10px;"></div>
        </div>

        <div class="form-group">
            <label for="confirm_password">
                <i class="fas fa-check-circle"></i> Yeni Şifre (Tekrar)
            </label>
            <input type="password" id="confirm_password" name="confirm_password" required 
                   placeholder="Yeni şifrenizi tekrar girin" autocomplete="new-password"
                   oninput="checkPasswordMatch()">
            <div id="password-match-indicator" style="margin-top: 10px;"></div>
        </div>

        <div class="form-actions">
            <button type="submit" class="button primary-button">
                <i class="fas fa-save"></i> Şifreyi Sıfırla
            </button>
            <a href="{{ url_for('reset_password_method') }}" class="button secondary-button">
                <i class="fas fa-times"></i> İptal
            </a>
        </div>
    </form>

    <script>
        function updatePasswordStrength() {
            const password = document.getElementById('new_password').value;
            const indicator = document.getElementById('password-strength-indicator');
            
            if (!password) {
                indicator.innerHTML = '';
                return;
            }
            
            const result = window.checkPasswordStrengthFrontend(password);
            indicator.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="color: ${result.color}; font-weight: bold;">Şifre Gücü: ${result.strength}</span>
                    <progress value="${result.strength === 'Zayıf' ? 25 : result.strength === 'Orta' ? 50 : result.strength === 'Güçlü' ? 75 : 100}" 
                              max="100" style="width: 150px; height: 8px;"></progress>
                </div>
            `;
        }

        function checkPasswordMatch() {
            const newPassword = document.getElementById('new_password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            const indicator = document.getElementById('password-match-indicator');
            
            if (!confirmPassword) {
                indicator.innerHTML = '';
                return;
            }
            
            if (newPassword === confirmPassword) {
                indicator.innerHTML = '<span style="color: #4CAF50;"><i class="fas fa-check"></i> Şifreler eşleşiyor</span>';
            } else {
                indicator.innerHTML = '<span style="color: #F44336;"><i class="fas fa-times"></i> Şifreler eşleşmiyor</span>';
            }
        }
    </script>
{% endblock %}

